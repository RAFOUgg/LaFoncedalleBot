version: '3.8'

services:
  # Service de l'API Flask
  lafoncedalleapi:
    build: .
    container_name: lafoncedalleapi
    restart: always
    # Lance uniquement l'API
    command: ["python", "app.py"]
    env_file:
      - .env
    volumes:
      - ./ratings.db:/app/ratings.db
    networks:
      - lafoncedallenet

  # Service du Bot Discord
  lafoncedallebot:
    build: .
    container_name: lafoncedallebot
    restart: always
    # Le bot attend que l'API soit prête
    depends_on:
      - lafoncedalleapi
    env_file:
      - .env
    volumes:
      - ./ratings.db:/app/ratings.db
    networks:
      - lafoncedallenet
    # Utilise la commande par défaut du Dockerfile (start.sh)

# Définition du réseau partagé
networks:
  lafoncedallenet:
    driver: bridge